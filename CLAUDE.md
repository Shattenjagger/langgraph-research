# CLAUDE.md

Этот файл содержит руководство для Claude Code (claude.ai/code) при работе с кодом в данном репозитории.

## Обзор проекта

Это исследовательский проект на Python, посвященный изучению LangGraph. Проект использует современную упаковку Python с `pyproject.toml` и требует Python 3.12 или выше.

Проект демонстрирует прогрессивное изучение LangGraph через 6 фаз - от базовой настройки до сложных многомодельных рабочих процессов для обработки кредитных заявок.

## Структура проекта

```
src/
├── models/                    # Управление локальными моделями
│   ├── local_model_manager.py # Менеджер с retry/fallback логикой
│   ├── model_configs.py       # Конфигурации трех типов моделей
│   └── fallback_chain.py      # Расширенная цепочка отказоустойчивости
├── nodes/                     # Узлы обработки для LangGraph
│   ├── classification.py      # Классификация документов
│   ├── processing.py          # Обработка и валидация данных
│   ├── decision.py            # Узлы принятия решений
│   └── loan_processing_nodes.py # Специализированные узлы для кредитов
├── workflows/                 # Определения рабочих процессов
│   ├── document_processing.py # Простая обработка документов
│   ├── conditional_workflow.py # Условное ветвление
│   └── complex_loan_workflow.py # Сложный кредитный процесс
└── utils/                     # Вспомогательные утилиты
    ├── retry_handler.py       # Продвинутые механизмы повторов
    └── fallback_strategies.py # Стратегии отказоустойчивости

examples/                      # Тесты и примеры по фазам
├── basic_setup_test.py        # Базовая проверка настройки
├── phase2_document_processing.py
├── phase3_conditional_branching.py  
├── phase4_retry_mechanisms.py
├── phase5_fallback_strategies.py
└── phase6_complex_workflow.py # Финальный комплексный тест
```

## Команды разработки

### Установка зависимостей
```bash
uv sync
```

### Настройка Ollama моделей  
```bash
ollama pull llama3.2:1b    # Быстрая модель
ollama pull llama3.2:3b    # Стандартная модель  
ollama pull llama3.1:8b    # Модель для рассуждений
```

### Запуск тестов по фазам
```bash
python examples/basic_setup_test.py        # Проверка настройки
python examples/phase2_document_processing.py  # Простая обработка
python examples/phase3_conditional_branching.py # Условное ветвление
python examples/phase4_retry_mechanisms.py     # Механизмы повторов
python examples/phase5_fallback_strategies.py  # Стратегии отказоустойчивости  
python examples/phase6_complex_workflow.py     # Сложный рабочий процесс (ФИНАЛ)
```

## Архитектурные заметки

Проект реализует продакшн-готовые паттерны:

### Управление моделями
- **Три типа моделей**: fast (1b), standard (3b), reasoning (8b)
- **Автоматические fallback цепочки**: reasoning → standard → fast
- **Circuit breakers** с независимыми состояниями для каждой модели
- **Конфигурируемые retry стратегии** для каждого типа модели

### LangGraph паттерны  
- **Условные ребра** для динамической маршрутизации
- **Сложное управление состоянием** с Pydantic моделями
- **Контрольные точки качества** на каждом этапе
- **Обработка ошибок и retry логика** на уровне узлов

### Отказоустойчивость
- **5 уровней fallback**: полный сервис → деградация → минимальный → кэш → человек
- **Интеллектуальное кэширование**: точное/семантическое/шаблонное сопоставление
- **Очередь эскалации к человеку** с управлением приоритетами
- **Голосование моделей** для критически важных решений

### Мониторинг
- **Комплексная статистика** использования моделей и повторов
- **Отслеживание производительности** по узлам и операциям  
- **Метрики качества** и показатели успешности
- **Структурированное логирование** всех операций

Проект служит полным руководством для создания корпоративных LLM-приложений с использованием LangGraph.